/* jdf-1.0.0/ globalReco.js Date:2017-02-09 17:08:53 */
define("/js/globalReco.js",[],function(){var c=function(a){if(this.param=$.extend({lid:readCookie("ipLoc-djd")||"",lim:6,ec:"utf-8",uuid:-1,pin:readCookie("pin")||""},a.param),this.$el=a.$el,this.template=a.template,this.reBuildJSON=a.reBuildJSON,this.skuHooks=a.skuHooks||"SKUS_recommend",this.ext=a.ext||{},this.callback=a.callback||function(){},this.debug=a.debug,!this.param.p)throw new Error("The param [p] is not Specificed");this.init()};return c.prototype={init:function(){var a=readCookie("__jda");this.param.lid=this.param.lid.indexOf("-")>0?this.param.lid.split("-")[0]:"1",this.param.uuid=a?"-"==a.split(".")[1]?-1:a.split(".")[1]:-1,this.get(this.rid)},get:function(){var c=this;var d;var e=pageConfig.queryParam;var f=[];if(pageConfig.product)for(d=0;d<pageConfig.product.cat.length;d++)this.param["c"+(d+1)]=pageConfig.product.cat[d];if(e){for(var g in e)e.hasOwnProperty(g)&&("c1"==g||"c2"==g||"c3"==g?c.param[g]=e[g]:f.push(g+":"+e[g]));c.param.hi=f.join(",")}this.debug&&console.info("//diviner.jd.com/diviner?"+decodeURIComponent($.param(this.param))),$.ajax({url:"//diviner.jd.com/diviner?"+decodeURIComponent($.param(this.param)),dataType:"jsonp",scriptCharset:this.param.ec,cache:!0,jsonpCallback:"call"+parseInt(1e5*Math.random(),10),success:function(a){var b=!!(a.success&&a&&a.data&&a.data.length);b?c.set(a):c.$el.html('<div class="ac">\u300c\u6682\u65e0\u6570\u636e\u300d</div>'),this.debug&&console.log(a),c.callback.apply(c,[b,a])}})},set:function(a){pageConfig[this.skuHooks]=[],a.skuHooks=this.skuHooks,a.ext=this.ext,this.reBuildJSON&&this.reBuildJSON>0&&(a.data=tools.reBuildJSON(a.data,this.reBuildJSON)),this.debug&&alert(this.template.process(a));try{this.$el.show().html(this.template.process(a))}catch(b){/isdebug/.test(location.href)&&"undefined"!=typeof console&&console.error("[pid="+this.param.p+"] "+b)}this.setTrackCode(a.impr)},setTrackCode:function(a){var b=this.$el.find("li");var c=this;var d="&m=UA-J2011-1&ref="+encodeURIComponent(document.referrer);b.each(function(){var a=$(this).attr("data-clk");$(this).bind("click",function(b){var e=$(b.target);(e.is("a")||e.is("img")||e.is("span"))&&c.newImage(a+d,!0),e.is("input")&&1==e.attr("checked")&&c.newImage(a+d,!0)})}),this.newImage(a+d,!0)},newImage:function(a,b,c){var d=new Image;a=b?a+"&random="+Math.random()+new Date:a,d.onload=function(){"undefined"!=typeof c&&c(a)},d.setAttribute("src",a)}},c});
